y = pos.fdr,
alpha = 0.01)) +
geom_point() +
geom_vline(xintercept = 0.1,
color = "red") +
geom_hline(yintercept = 0.1,
color = "red") +
ggtitle("Comparison of positive and negative selection fdr values") +
theme(legend.position="none")
# Compare positive score and negative score
ggplot(mageck, aes(x = pos.score,
y = neg.score,
alpha = 0.01)) +
geom_density_2d_filled() +
ggtitle("Comparison of positive score and negative score")
#sig_negs <- na.omit(filter(mageck$neg.fdr, mageck$neg.fdr != 1))
#### log fold change
# Distribution of lfc (positive and negative values the same)
ggplot(mageck, aes(x = lfc)) +
geom_histogram(bins = 500) +
xlab("lfc") +
ggtitle("Distribution of log fold change for all genes")
# Check normality of variable
qqnorm(mageck$lfc, main = "Normality of log fold change")
qqline(mageck$lfc)
### number of sgRNA's
ggplot(mageck, aes(num)) +
geom_bar(aes(fill = num)) +
geom_text(stat = 'count',
aes(label = after_stat(count)),
vjust = -0.5) +
ggtitle("Distribution of number of guide RNAs used")
### goodsgrna
# positive selection
ggplot(mageck, aes(pos.goodsgrna)) +
geom_bar(aes(fill = pos.goodsgrna)) +
geom_text(stat = 'count',
aes(label = after_stat(count)),
vjust = -0.5) +
ggtitle("Distribution of negative selection `goodsgrna`")
# negative selection
ggplot(mageck, aes(neg.goodsgrna)) +
geom_bar(aes(fill = neg.goodsgrna)) +
geom_text(stat = 'count',
aes(label = after_stat(count)),
vjust = -0.5) +
ggtitle("Distribution of negative selection `goodsgrna`")
### number of sgRNA's
ggplot(mageck, aes(num)) +
geom_bar(aes(fill = num)) +
geom_text(stat = 'count',
aes(label = after_stat(count)),
vjust = -0.5) +
ggtitle("Distribution of number of guide RNAs used")
### goodsgrna
# positive selection
ggplot(mageck, aes(pos.goodsgrna)) +
geom_bar(aes(fill = pos.goodsgrna)) +
geom_text(stat = 'count',
aes(label = after_stat(count)),
vjust = -0.5) +
ggtitle("Distribution of negative selection `goodsgrna`")
# negative selection
ggplot(mageck, aes(neg.goodsgrna)) +
geom_bar(aes(fill = neg.goodsgrna)) +
geom_text(stat = 'count',
aes(label = after_stat(count)),
vjust = -0.5) +
ggtitle("Distribution of negative selection `goodsgrna`")
# Create correlation plot
library(corrplot)
cor.crispr <- cor(mageck[,-c(1,2,7,12)])
corrplot(cor.crispr,
method = "color")
# Plot lfc with pos and neg fdr
plot(mageck$neg.fdr,
mageck$lfc)
plot(mageck$pos.fdr,
mageck$lfc)
plot(mageck$neg.rank,
mageck$lfc)
plot(mageck$pos.rank,
mageck$lfc)
hist(mageck$lfc)
# Code adapted from https://stackoverflow.com/questions/6602881/text-file-to-list-in-r
# Read in pathways data as list and split elements into strings
gmt <- scan("m2.cp.v2022.1.Mm.symbols.gmt", what = "", sep = "\n")
pathways <- strsplit(gmt, "[[:space:]]+")
# Assign first entry to names of each list element
names(pathways) <- sapply(pathways, `[[`, 1)
# save urls to separate list for reference
source <- sapply(pathways, `[[`, 2)
# Change gene names to lowercase to reduce errors
pathways <- lapply(pathways[-1], tolower)
# Remove two beginning reference rows
pathways <- lapply(pathways, `[`, -c(1:2))
# Preview data set
head(pathways)
library(ggridges)
selection <- NULL
# Sort values based on p-values to see which selection p-value is lower
for (i in 1:length(mageck$id)){
if (mageck$neg.p_value[i] > mageck$pos.p_value[i]){
selection[i] <- "positive"
} else {
selection[i] <- "negative"
}
}
# Append to mageck data frame as factor
mageck$selection <- as.factor(selection)
summary(mageck$selection)
# Compare lfc across selections
ggplot(mageck, mapping = aes(x = lfc,
group = selection,
fill = selection,
alpha = 0.05)) +
geom_density() +
ggtitle("Log fold change distribution for positive and negative selections")
# Create separate data frames for each positive and negative selection
#  and remove selection variable from each
positives <- mageck[mageck$selection == "positive", -14]
negatives <- mageck[mageck$selection == "negative", -14]
# Compare lfc in both groups
hist(positives$lfc)
hist(negatives$lfc)
summary(positives$lfc)
summary(negatives$lfc)
qqnorm(positives$lfc)
qqnorm(negatives$lfc)
t.test(negatives$lfc, positives$lfc)
lfc_sort <- mageck[order(mageck$lfc, decreasing = TRUE),]
mageck_lfc_sort <- as.vector(lfc_sort$lfc)
names(mageck_lfc_sort) <- lfc_sort$id
library(BiocManager)
library(fgsea)
SampleES <- fgseaSimple(
pathways = pathways[1:4],
stats = mageck_lfc_sort,
nperm = 1000,
minSize = 5,
scoreType = "std",
gseaParam = 1
)
Sample2ES <- fgseaSimple(
pathways = pathways[1:10],
stats = mageck_lfc_sort,
nperm = 1000,
minSize = 5,
scoreType = "std",
gseaParam = 1
)
SampleES
Sample2ES
ls("fgsea")
ls("GSEA")
ns("GSEA")
?ls
?plotEnrichment
??plotEnrichment
Sample2ES
knitr::opts_chunk$set(echo = TRUE)
sample_plot <- fgsea::plotEnrichment(pathway = pathways[5],
stats = mageck_lfc_sort,
gseaParam = 1)
SampleES <- fgseaSimple(
pathways = pathways[1:4],
stats = mageck_lfc_sort,
nperm = 1000,
minSize = 5,
scoreType = "std",
gseaParam = 1
)
SampleES <- fgsea::fgseaSimple(
pathways = pathways[1:4],
stats = mageck_lfc_sort,
nperm = 1000,
minSize = 5,
scoreType = "std",
gseaParam = 1
)
SampleES
pathways[5]
pathways[[5]]
sample_plot <- fgsea::plotEnrichment(pathway = pathways[[5]],
stats = mageck_lfc_sort,
gseaParam = 1)
sample_plot
mageck["prkag1",]
mageck["akap8",]
mageck[id=="akap8",]
mageck[mageck$id=="akap8",]
mageck[mageck$id=="tsc1",]
mageck[mageck$id=="prkar2b",]
mageck[mageck$id=="musk",]
print(mageck[mageck$id=="musk",])
if (length(mageck[mageck$id =="musk"]) != 0){
print(mageck[mageck$id=="musk",])
}
if (length(mageck[mageck$id =="musk"]) == 0){
print(mageck[mageck$id=="musk",])
}
else {
if (length(mageck[mageck$id =="musk"]) == 0){
print(mageck[mageck$id=="musk",])
}
if (length(mageck[mageck$id =="musk"],) == 0){
print(mageck[mageck$id=="musk"],)
}
if (length(mageck[mageck$id =="musk",]) == 0){
print(mageck[mageck$id=="musk",])
}
else {
if (length(mageck[mageck$id =="musk",]) == 0){
print(mageck[mageck$id=="musk",])
} else {
print("No results found")
}
if (length(mageck[mageck$id =="musk",]) != 0){
print(mageck[mageck$id=="musk",])
} else {
print("No results found")
}
library(dplyr)
# Remove observations where `num` for sgRNA != 4
mageck <- filter(
mageck,
mageck$num == "4"
)
mageck <- filter(
mageck,
mageck$num == "4"
)
summary(mageck)
# Import MAGeCK data set
library(readr)
library(ggplot2)
library(dplyr)
mageck <- read_delim("mageckRRA.gene_summary.txt",
delim = "\t", escape_double = FALSE,
trim_ws = TRUE)
# Reassign column names
colnames(mageck) <- c("id",
"num",
"neg.score",
"neg.p_value",
"neg.fdr",
"neg.rank",
"neg.goodsgrna",
"neg.lfc",
"pos.score",
"pos.p_value",
"pos.fdr",
"pos.rank",
"pos.goodsgrna",
"lfc"
)
# Change `id` column to all lowercase characters
mageck$id <- tolower(mageck$id)
# Convert goodsgrna to factor
mageck$neg.goodsgrna <- as.factor(mageck$neg.goodsgrna)
mageck$pos.goodsgrna <- as.factor(mageck$pos.goodsgrna)
# Delete neg.lfc
mageck <- mageck[,-8]
# view data summary
summary(mageck)
# Remove observations where `num` for sgRNA != 4
mageck <- filter(
mageck,
mageck$num == "4"
)
# view data summary
summary(mageck)
mageck <- read_delim("mageckRRA.gene_summary.txt",
delim = "\t", escape_double = FALSE,
trim_ws = TRUE)
# Reassign column names
colnames(mageck) <- c("id",
"num",
"neg.score",
"neg.p_value",
"neg.fdr",
"neg.rank",
"neg.goodsgrna",
"neg.lfc",
"pos.score",
"pos.p_value",
"pos.fdr",
"pos.rank",
"pos.goodsgrna",
"lfc"
)
# Change `id` column to all lowercase characters
mageck$id <- tolower(mageck$id)
# Convert goodsgrna to factor
mageck$neg.goodsgrna <- as.factor(mageck$neg.goodsgrna)
mageck$pos.goodsgrna <- as.factor(mageck$pos.goodsgrna)
# Delete neg.lfc
mageck <- mageck[,"neg.lfc"]
head(mageck)
# Delete neg.lfc
mageck <- mageck[,-"neg.lfc"]
mageck <- read_delim("mageckRRA.gene_summary.txt",
delim = "\t", escape_double = FALSE,
trim_ws = TRUE)
# Reassign column names
colnames(mageck) <- c("id",
"num",
"neg.score",
"neg.p_value",
"neg.fdr",
"neg.rank",
"neg.goodsgrna",
"neg.lfc",
"pos.score",
"pos.p_value",
"pos.fdr",
"pos.rank",
"pos.goodsgrna",
"lfc"
)
# Change `id` column to all lowercase characters
mageck$id <- tolower(mageck$id)
# Convert goodsgrna to factor
mageck$neg.goodsgrna <- as.factor(mageck$neg.goodsgrna)
mageck$pos.goodsgrna <- as.factor(mageck$pos.goodsgrna)
# Delete neg.lfc
mageck <- mageck[,-c("neg.lfc")]
# Delete neg.lfc
mageck <- -mageck[,"neg.lfc"]
head(mageck)
mageck <- read_delim("mageckRRA.gene_summary.txt",
delim = "\t", escape_double = FALSE,
trim_ws = TRUE)
# Reassign column names
colnames(mageck) <- c("id",
"num",
"neg.score",
"neg.p_value",
"neg.fdr",
"neg.rank",
"neg.goodsgrna",
"neg.lfc",
"pos.score",
"pos.p_value",
"pos.fdr",
"pos.rank",
"pos.goodsgrna",
"lfc"
)
# Change `id` column to all lowercase characters
mageck$id <- tolower(mageck$id)
# Convert goodsgrna to factor
mageck$neg.goodsgrna <- as.factor(mageck$neg.goodsgrna)
mageck$pos.goodsgrna <- as.factor(mageck$pos.goodsgrna)
# Delete neg.lfc
mageck <- mageck[, select = -c("neg.lfc")]
head(mageck)
# Delete neg.lfc
mageck <- mageck[, select = -c("neg.lfc")]
View(mageck)
# Delete neg.lfc
mageck <- mageck[, select = -c(neg.lfc)]
mageck <- mageck %>%
filter(mageck$num == "4") %>%
-select(c("neg.lfc", "num"))
mageck <- mageck %>%
filter(mageck$num == "4") %>%
-select(c(neg.lfc, num))
head(mageck)
# Remove observations where `num` for sgRNA != 4
mageck <- mageck %>%
filter(mageck$num == "4") %>%
-select(c(mageck$neg.lfc, mageck$num))
# Remove observations where `num` for sgRNA != 4
mageck <- mageck %>%
filter(mageck$num == "4") %>%
select(-c(neg.lfc, num))
head(mageck)
# view data summary
summary(mageck)
19500*.06
# Remove observations where `num` for sgRNA != 4
## then drop unnecessary `num` and `neg.lfc` columns
mageck <- mageck %>%
filter(mageck$num == "4") %>%
select(-c(neg.lfc, num)) %>%
tolower(id)
# Remove observations where `num` for sgRNA != 4
## then drop unnecessary `num` and `neg.lfc` columns
mageck <- mageck %>%
filter(mageck$num == "4") %>%
select(-c(neg.lfc, num)) %>%
mutate(across(id), tolower)
mageck <- read_delim("mageckRRA.gene_summary.txt",
delim = "\t", escape_double = FALSE,
trim_ws = TRUE)
# Reassign column names
colnames(mageck) <- c("id",
"num",
"neg.score",
"neg.p_value",
"neg.fdr",
"neg.rank",
"neg.goodsgrna",
"neg.lfc",
"pos.score",
"pos.p_value",
"pos.fdr",
"pos.rank",
"pos.goodsgrna",
"lfc"
)
# Convert goodsgrna to factor
mageck$neg.goodsgrna <- as.factor(mageck$neg.goodsgrna)
mageck$pos.goodsgrna <- as.factor(mageck$pos.goodsgrna)
# Remove observations where `num` for sgRNA != 4
# then drop unnecessary `num` and `neg.lfc` columns.
# Change `id` column to all lowercase characters.
mageck <- mageck %>%
filter(mageck$num == "4") %>%
select(-c(neg.lfc, num)) %>%
mutate(across(id), tolower)
# Remove observations where `num` for sgRNA != 4
# then drop unnecessary `num` and `neg.lfc` columns.
# Change `id` column to all lowercase characters.
mageck <- mageck %>%
filter(mageck$num == "4") %>%
select(-c(neg.lfc, num)) %>%
mutate(across(id, tolower))
# view data summary
summary(mageck)
head(mageck)
# Remove observations where `num` for sgRNA != 4
# then drop unnecessary `num` and `neg.lfc` columns.
# Change `id` column to all lowercase characters.
mageck <- mageck %>%
filter(mageck$num == "4") %>%
select(-c(neg.lfc, num)) %>%
mutate(across(id, tolower)) %>%
mutate(across(c(neg.goodsgrna,
pos.goodsgrna),
as.factor))
mageck <- read_delim("mageckRRA.gene_summary.txt",
delim = "\t", escape_double = FALSE,
trim_ws = TRUE)
# Reassign column names
colnames(mageck) <- c("id",
"num",
"neg.score",
"neg.p_value",
"neg.fdr",
"neg.rank",
"neg.goodsgrna",
"neg.lfc",
"pos.score",
"pos.p_value",
"pos.fdr",
"pos.rank",
"pos.goodsgrna",
"lfc"
)
# Remove observations where `num` for sgRNA != 4
# then drop unnecessary `num` and `neg.lfc` columns.
# Change `id` column to all lowercase characters.
mageck <- mageck %>%
filter(mageck$num == "4") %>%
select(-c(neg.lfc, num)) %>%
mutate(across(id, tolower)) %>%
mutate(across(c(neg.goodsgrna,
pos.goodsgrna),
as.factor))
# view data summary
summary(mageck)
data <- read_delim("mageckRRA.gene_summary.txt",
delim = "\t", escape_double = FALSE,
trim_ws = TRUE)
# Reassign column names
colnames(data) <- c("id",
"num",
"neg.score",
"neg.p_value",
"neg.fdr",
"neg.rank",
"neg.goodsgrna",
"neg.lfc",
"pos.score",
"pos.p_value",
"pos.fdr",
"pos.rank",
"pos.goodsgrna",
"lfc"
)
# Filter and clean data
mageck <- data %>%
# Remove observations where `num` for sgRNA != 4
filter(num == "4") %>%
# Drop unnecessary `num` and `neg.lfc` columns.
select(-c(neg.lfc, num)) %>%
# Change `id` column to all lowercase characters.
mutate(across(id, tolower)) %>%
# Convert to type factor
mutate(across(c(neg.goodsgrna,
pos.goodsgrna),
as.factor))
# view data summary
summary(mageck)
str(pathways)
?write.table
SampleES
colnames(SampleES)
?BiocManager
??BiocManager
